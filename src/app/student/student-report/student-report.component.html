<div class="page-title" *ngIf="!displayViewReport">
  <div class="title_left">
    <h3>Liste des rapports</h3>
  </div>
  <!-- bouton ajouter -->
  <div class="title_right">
    <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
      <div class="input-group pull-right">
        <button type="button" class="btn green bg-green" (click)="createReport()" >Ajouter un Rapport</button>
      </div>
    </div>
  </div>
</div>

<div class="clearfix"></div>
<!-- CHAMPS RECHERCHE -->
<div class="row" *ngIf="!displayViewReport">

  <!-- champ de recherche par auteur -->
  <div class="col-md-3 col-xs-5 form-group top_search filterStyle" id="search_author">
    <div class="">
      Filtrer par étudiants<br />
      <select class="form-control input-sm" [(ngModel)]="selectedStudent" (change)="filterReportsByStudent(selectedStudent)">
        <option value="0">Tous les étudiants</option>
        <option value="{{ student.studentId }}" *ngFor="let student of students">{{ student.studentName }}</option>
      </select>
    </div>
  </div>
  <!-- champ recherche par date picker -->
  <div class="col-md-3 col-xs-6 form-group top_search filterStyle" id="search_date">
    <div class="">
        Filtrer par date<br />
      <input type="date" class="form-control" [(ngModel)]="selectedDate" (change)="filterReportsByDate(selectedDate)" data-inputmask="'mask': 'jj/mm/aaaa'">
    </div>
  </div>

</div>
<!-- Liste des formations -->
<div class="row" *ngIf="!displayViewReport">
  <div class="col-md-12 col-xd-12">
    <!-- Tableau des formations -->
    <table class="table table-borderless space" style="color: #999" id="listingReport">
      <thead class="">
        <tr class="tablecolor rad text-row">
          <th scope="col"></th>
          <th scope="col">#</th>
          <th scope="col">Auteur</th>
          <th scope="col">Titre du rapport</th>
          <th scope="col">Notation</th>
          <th scope="col">Date de création</th>
          <th scope="col">Dernière modification</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of dataReport" class="shadow bg-white rad text-row" (click)="viewReport(item)">
          <td></td>
          <td scope="row" width="40">{{ item.report_id }}</td>
          <td>
            <img src="{{ environment.appImageUrl }}{{ item.studentAvatar }}" class="img-circle pull-left" width="100%">
            <div class="pull-left" style="margin: 13px 0 0 10px;">
              <span class="alignleft">{{ item.studentLastname }}</span><br/>
              <span class="alignleft">{{ item.studentFirstname }}</span>
            </div>
          </td>
          <td>{{ item.report_title }}</td>
          <td>
            <div class="emoji">
              <i class="far fa-smile-wink" style="font-size: 34px; margin: 0 5px 0 0;" [class.yellow]="item.report_rate == 5" ></i>
              <i class="far fa-smile" style="font-size: 34px; margin: 0 5px 0 0;" [class.yellow]="item.report_rate == 4"></i>
              <i class="far fa-angry" style="font-size: 34px; margin: 0 5px 0 0;" [class.yellow]="item.report_rate == 3"></i>
              <i class="far fa-frown" style="font-size: 34px; margin: 0 5px 0 0;" [class.yellow]="item.report_rate == 2"></i>
              <i class="far fa-sad-cry" style="font-size: 34px; margin: 0 5px 0 0;" [class.yellow]="item.report_rate == 1"></i>
            </div>
          </td>
          <td>
            <span class="alignleft">{{ item.report_date  | date:format }}</span>
          </td>
          <td>{{ item.report_last_edit_date | date:format }}</td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div id="viewReport" *ngIf="displayViewReport">

  <button type="button" id="closeModal" class="btn bg-red icon no-border" (click)="closeViewReport()">Close</button>

  <!-- div sans formulaire si consultation-->
  <div id="viewOnly" *ngIf="!displayEditReport">
    <div class="item" style="padding: 45px;">
      <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">Titre <span>*</span></label>
      <div class="col-md-6 col-sm-6 col-xs-12"> {{report.report_title}} </div>
    </div>
    <div class="item" style="padding: 39px; margin: 4px;">
      <label class="control-label col-md-3 col-sm-3 col-xs-12" for="number">Notation <span>*</span></label>
      <div class="col-md-6 col-sm-6 col-xs-12">
        {{report.report_rate}}
      </div>
    </div>
    <div class="item" style="padding: 14px; margin: -74px; text-align: left;">
      <div class="pull-right">
        <label for="toggle{{ report.is_daily }}" class="labChecky" [innerHtml]="stateText()"></label>
      </div>

    </div>
    <div class="item">
      <div class="item">
        <label class="col-md-3 col-sm-3 col-xs-12" for="name">Contenu <span>*</span></label>
        <div class="col-md-6 col-sm-6 col-xs-12">
          {{report.text}}
        </div>
      </div>
    </div>
  </div>

  <!-- div avec formulaire si rapport appartient a l etudiant connecte -->
  <div id='editReport' *ngIf="displayEditReport">
    <!-- titre -->
    <div class="item form-group">
      <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">Titre <span class="required">*</span></label>
      <div class="col-md-6 col-sm-6 col-xs-12">
        <input id="name" class="form-control col-md-7 col-xs-12" data-validate-length-range="6" data-validate-words="2" name="name" placeholder="" required="required" type="text">
      </div>
    </div>
    <!-- rating -->
    <div class="item form-group">
      <label class="control-label col-md-3 col-sm-3 col-xs-12" for="number">Notation <span class="required">*</span>
      </label>
      <div class="col-md-6 col-sm-6 col-xs-12">
        <input type="number" id="number" name="number" required="required" data-validate-minmax="10,100" class="form-control col-md-7 col-xs-12">
      </div>
    </div>
    <div>
      <div class="col-md-9 col-sm-9 col-xs-12">
        <div class="pull-right">
          <input id="toggle{{ report.is_daily }}" type="checkbox" class="checky" [checked]="report.is_daily">
          <label for="toggle{{ report.is_daily }}" class="labChecky" [innerHtml]="stateText()"></label>
        </div>
      </div>
    </div>
    <div class="form-group modal-body">
      <div class="x_content jumbotron">
        <div [froalaEditor] id="text" [(froalaModel)]="report.text"></div>
      </div>
      <div>
        <button  type="button" [disabled]="loading" (click)="saveReport()" class="btn bg-blue icon no-border">Enregistrer</button>
      </div>
    </div>
  </div>

</div>

